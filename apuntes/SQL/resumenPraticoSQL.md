## 7) SQL — Plantillas mínimas (Oracle)

**SELECT plantilla** (lo que casi siempre necesitas):

```sql
SELECT c1, c2, fn(c3) AS alias
FROM   t1
[JOIN  t2 ON t1.id = t2.id]
WHERE  condiciones
GROUP  BY c1, c2
HAVING condiciones_agregadas
ORDER  BY 1 ASC, 2 DESC
FETCH FIRST 10 ROWS ONLY; -- (12c+). Alternativa: WHERE ROWNUM <= 10
```

**Filtros útiles**

```sql
WHERE city IN ('MADRID','SEVILLA')
  AND price BETWEEN 100 AND 300
  AND name LIKE 'ANA%'
  AND (col IS NULL OR col = 0)
```

**JOINs**

```sql
-- INNER: sólo coincidencias
a JOIN b ON a.k = b.k
-- LEFT: todo a, tenga o no b
a LEFT JOIN b ON a.k = b.k
-- Filas sin pareja en b (anti-join)
a LEFT JOIN b ON a.k = b.k
WHERE b.k IS NULL;
```

**GROUP BY/HAVING**

```sql
SELECT dept, COUNT(*) n, AVG(sal) media
FROM emp
GROUP BY dept
HAVING COUNT(*) >= 3
ORDER BY media DESC;
```

**Subconsultas**

```sql
-- IN: conjunto concreto
WHERE e.dept_id IN (SELECT id FROM dept WHERE city='MADRID');
-- EXISTS: suele cortar antes
WHERE EXISTS (SELECT 1 FROM dept d WHERE d.id=e.dept_id AND d.city='MADRID');
```

**Funciones que dan puntos**: `NVL(x,def)`, `COALESCE(a,b,c)`, `CASE WHEN`, `SUBSTR`, `INSTR`, `TRUNC(fecha)`, `ROUND`.

**DDL y constraints (mini)**

```sql
CREATE TABLE COURSES (
  ID     NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  CODE   VARCHAR2(10) UNIQUE NOT NULL,
  TITLE  VARCHAR2(100) NOT NULL,
  HOURS  NUMBER CHECK (HOURS BETWEEN 1 AND 300)
);

ALTER TABLE ENROLLMENTS ADD CONSTRAINT FK_ENR_COU
  FOREIGN KEY (COURSE_ID) REFERENCES COURSES(ID) ON DELETE CASCADE;

COMMIT;  -- confirma cambios DML
ROLLBACK; -- deshace cambios no confirmados
```

---


